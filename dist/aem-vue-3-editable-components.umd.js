(function(f,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("@adobe/aem-spa-component-mapping"),require("vue"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","@adobe/aem-spa-component-mapping","vue","@adobe/aem-spa-page-model-manager"],g):(f=typeof globalThis<"u"?globalThis:f||self,g(f.aemVue3EditableComponents={},f.AemSpaComponentMapping,f.Vue,f.AemSpaPageModelManager))})(this,function(f,g,t,u){"use strict";function R(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var E={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function c(s){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c(s)}var i=47,l=46,d=function(n){var o=c(n);if(o!=="string")throw new TypeError("Expected a string, got a ".concat(o))},h=function(n,o){for(var a="",y=0,q=-1,_=0,I,C=0;C<=n.length;++C){if(C<n.length)I=n.charCodeAt(C);else{if(I===i)break;I=i}if(I===i){if(!(q===C-1||_===1))if(q!==C-1&&_===2){if(a.length<2||y!==2||a.charCodeAt(a.length-1)!==l||a.charCodeAt(a.length-2)!==l){if(a.length>2){var B=a.lastIndexOf("/");if(B!==a.length-1){B===-1?(a="",y=0):(a=a.slice(0,B),y=a.length-1-a.lastIndexOf("/")),q=C,_=0;continue}}else if(a.length===2||a.length===1){a="",y=0,q=C,_=0;continue}}o&&(a.length>0?a+="/..":a="..",y=2)}else a.length>0?a+="/"+n.slice(q+1,C):a=n.slice(q+1,C),y=C-q-1;q=C,_=0}else I===l&&_!==-1?++_:_=-1}return a},p=function(n){try{return decodeURIComponent(n)}catch{return n}},m=function(n){d(n);var o=n;if(o.length===0)return".";var a=o.charCodeAt(0)===i,y=o.charCodeAt(o.length-1)===i;return o=p(o),o=h(o,!a),o.length===0&&!a&&(o="."),o.length>0&&y&&(o+="/"),a?"/"+o:o},P=m;e.default=P,r.exports=e.default})(E,E.exports);var U=E.exports;const M=R(U),k={getCQPath(r){const{pagePath:e="",itemPath:c="",injectPropsOnInit:i}=r;let{cqPath:l=""}=r;return i&&!l&&(l=M(c?`${e}/jcr:content/${c}`:e),l=l.replace(/^\.$/,"")),l},modelToProps(r){const e=Object.getOwnPropertyNames(r),c={},i=l=>{const d=l.substring(1);return`cq${d.substring(0,1).toUpperCase()}${d.substring(1)}`};return e.forEach(l=>{let d=l;d.startsWith(":")&&(d=i(d)),c[d]=r[l]}),c}},b=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(r){const e=r,c=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),i=t.useSlots(),l=t.useAttrs(),d=t.computed(()=>{const m={},{componentProperties:P}=e;return c&&(m["data-cq-data-path"]=P.cqPath,e.editConfig.resourceType&&(m["data-cq-resource-type"]=e.editConfig.resourceType)),m}),h=t.computed(()=>{var o;const m={},{componentProperties:P}=e,{appliedCssClassNames:s}=P,n=[];return s&&n.push(s),(o=e==null?void 0:e.containerProps)!=null&&o.class&&n.push(e.containerProps.class),n.length&&(m.class=n.join(" ")),m}),p=t.computed(()=>c&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties)?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return(m,P)=>{var s,n,o,a;return!t.unref(c)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration||e.componentProperties.hasOwnProperty("cqHierarchyType")&&e.componentProperties.cqHierarchyType==="page"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((n=(s=t.unref(i)).default)==null?void 0:n.call(s)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(l)})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...d.value,...h.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((a=(o=t.unref(i)).default)==null?void 0:a.call(o)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(l),componentProperties:e.componentProperties})),null,16)),p.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},p.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(r){const e=r,c=t.useSlots(),i=t.useAttrs();return(l,d)=>(t.openBlock(),t.createBlock(b,t.normalizeProps(t.guardReactiveProps({...t.unref(i),componentProperties:{...t.unref(i)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var h,p;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(h=t.unref(c)).default)==null?void 0:p.call(h)[0])))]}),_:1},16))}}),A=t.defineComponent({inheritAttrs:!1,__name:"ModelProvider",props:{cqPath:{type:String},cqForceReload:{type:Boolean,default:!1},injectPropsOnInit:{type:Boolean,default:!1},pagePath:{type:String},itemPath:{type:String}},setup(r){const e=r,c=t.useSlots(),i=t.useAttrs(),l=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),d=t.ref(i),h=()=>{const{pagePath:P,itemPath:s,injectPropsOnInit:n,cqPath:o}=e;return k.getCQPath({pagePath:P,itemPath:s,injectPropsOnInit:n,cqPath:o})},p=P=>{const{pagePath:s,itemPath:n,injectPropsOnInit:o}=e,a=P||e.cqPath||s&&k.getCQPath({pagePath:s,itemPath:n,injectPropsOnInit:o});a&&u.ModelManager.getData({path:a,forceReload:e.cqForceReload}).then(y=>{y&&Object.keys(y).length>0&&(Object.assign(d.value,k.modelToProps(y)),o&&l&&u.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(y=>{console.error(y)})},m=p.bind(null,h());return t.onMounted(()=>{const P=h();e.injectPropsOnInit&&p(P),u.ModelManager.addListener(P,m)}),t.onUnmounted(()=>{u.ModelManager.removeListener(e.cqPath,m)}),(P,s)=>{var n,o;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((o=(n=t.unref(c)).default)==null?void 0:o.call(n)[0]),t.normalizeProps(t.guardReactiveProps({cqPath:h(),...d.value})),null,16)}}}),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(r){const e=r,c=t.useSlots(),i=t.useAttrs(),{modelConfig:l}=t.toRefs(e),d=i.cqForceReload||l.value.forceReload,{injectPropsOnInit:h}=l.value;return(p,m)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(d),"inject-props-on-init":t.unref(h)},{...t.unref(i)}),{default:t.withCtx(()=>{var P,s;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((s=(P=t.unref(c)).default)==null?void 0:s.call(P)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),w=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(r){const e=t.useSlots(),c=t.useAttrs(),i=t.inject("componentMapping",new g.ComponentMapping),l=t.inject("isInEditor",u.AuthoringUtils.isInEditor());return t.provide("isInEditor",l),t.provide("componentMapping",i),(d,h)=>{var p,m;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((m=(p=t.unref(e)).default)==null?void 0:m.call(p)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(c)})),null,16)}}}),N=r=>t.h(w,{},()=>[t.h(r)]),D=(r,e)=>t.h(O,{modelConfig:e},()=>[t.h(r)]),S=(r,e)=>t.h(j,{editConfig:e},()=>[t.h(r)]),x=(r,e,c)=>{const{injectPropsOnInit:i=!0,forceReload:l=!1,...d}=c||{},h={injectPropsOnInit:i,forceReload:l,...d};let p=r;return p=N(D(S(p,e),h)),p},G=g.ComponentMapping.map,V=g.ComponentMapping.get;g.ComponentMapping.map=function(e,c,i={isEmpty:()=>!1},l={}){const{injectPropsOnInit:d=!1,...h}=l||{},p=x(c,i,{injectPropsOnInit:d,...h});return G.call(g.ComponentMapping,e,p),p},g.ComponentMapping.get=V;const Q=r=>(e,c,i={})=>g.ComponentMapping.map(r,e,c,i),H=(r,e,c,i)=>{let l=[];r&&(l=[r]),e&&l.push(e);const d=c==null?void 0:c.class;return d&&!i&&l.push(d),l},W=r=>({appliedCssClassNames:{type:String},baseCssClass:{type:String,default:r},containerProps:{type:Object,default:()=>{}},id:{type:String}}),J=["data-cq-data-path","data-emptytext"],T=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(r){const e=r;return(c,i)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,J))}}),X=["data-text"],$=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(r){const e=r,c=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(i,l)=>{var d;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(d=e.placeholderProps)==null?void 0:d.placeholderClassNames])},[t.createElementVNode("div",{"data-text":c.value,class:"aem-AllowedComponent--title"},null,8,X),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,h=>(t.openBlock(),t.createBlock(T,{key:h.path,"empty-label":h.title,path:h.path},null,8,["empty-label","path"]))),128))],2)}}}),Y=["data-cq-data-path"],L=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(r){const e=r;return(c,i)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,Y))}}),F=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(r){const e=r,c=t.useAttrs(),i=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),l=t.inject("componentMapping",new g.ComponentMapping),d=s=>{var n;return((n=e.cqPath)==null?void 0:n.length)>0?`${e.cqPath}/${s}`:s},h=(s,n,o)=>{const a=d(o);return t.h(s,{...n,cqPath:a,containerProps:typeof e.getItemComponentProps=="function"?e.getItemComponentProps(o):{}})},p=t.computed(()=>{let s={};return typeof e.getContainerProps=="function"?s=e.getContainerProps():(s={class:"aem-container"},i&&(s["data-cq-data-path"]=e.cqPath)),s}),m=t.computed(()=>{const s=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(n=>{const o=k.modelToProps(e.cqItems[n]);if(o&&typeof o.cqType<"u"){const a=l.get(o.cqType);a&&s.push(h(a,o,n))}}),s}),P=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(s,n)=>!t.unref(i)&&e.aemNoDecoration?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:0},t.renderList(m.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),t.mergeProps({key:o.toString()},{...t.unref(c)}),null,16))),128)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...p.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(m.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),t.mergeProps({key:o.toString()},{...t.unref(c)}),null,16))),128)),t.unref(i)?(t.openBlock(),t.createBlock(L,t.normalizeProps(t.mergeProps({key:0},P.value)),null,16)):t.createCommentVNode("",!0)],16))}}),z=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},aemNoDecoration:{type:Boolean,default:!1},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(r){const e=r,c=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),i=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),l=t.useAttrs();return(d,h)=>{var p;return t.unref(c)&&e.allowedComponents&&((p=e.allowedComponents)!=null&&p.applicable)?(t.openBlock(),t.createBlock($,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":i.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):(t.openBlock(),t.createBlock(F,t.mergeProps({key:1,"aem-no-decoration":e.aemNoDecoration,"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps,"is-in-editor":t.unref(c)},{...t.unref(l)}),null,16,["aem-no-decoration","cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props","is-in-editor"]))}}}),Z=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(r){const e=r,c=t.useAttrs(),i=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),l=t.inject("componentMapping",new g.ComponentMapping),d=s=>{var n;return((n=e.cqPath)==null?void 0:n.length)>0?`${e.cqPath}/jcr:content/${s}`:s},h=(s,n,o)=>{const a=d(o);return t.h(s,{...n,cqPath:a,containerProps:{}})},p=t.computed(()=>{const s=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(n=>{const o=k.modelToProps(e.cqItems[n]);if(o&&typeof o.cqType<"u"){const a=l.get(o.cqType);a&&s.push(h(a,o,n))}}),s}),m=t.computed(()=>{const s=[];return Object.keys(e.cqChildren).length===0||Object.keys(e.cqChildren).forEach(n=>{const o=k.modelToProps(e.cqChildren[n]);if(o&&typeof o.cqType<"u"){const a=l.get(o.cqType);a&&s.push(t.h(a,{...o,cqPath:o.cqPath}))}}),s}),P=t.computed(()=>{const s=["aem-page"];c.cssClassNames&&s.push(...c.cssClassNames.split(" "));const n={class:s.join(" ")};return i&&(n["data-cq-data-path"]=e.cqPath),n});return(s,n)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(P.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(m.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128))],16))}}),K=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{aemNoDecoration:{type:Boolean,default:!1},cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0}},setup(r){const e=r,c=t.useAttrs(),i=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),l=()=>{const p={},m=["aem-container"];return e.gridClassNames&&m.push(e.gridClassNames),p.class=m.join(" "),i&&(p["data-cq-data-path"]=e.cqPath),p},d=()=>{const p={cqPath:e.cqPath},m=["new","section","aem-Grid-newComponent"];return p.placeholderClassNames=m.join(" "),p},h=p=>{const m={};return e.columnClassNames&&e.columnClassNames[p]&&(m.class=e.columnClassNames[p]),e.aemNoDecoration&&(m["data-no-decoration"]=!0),m};return(p,m)=>(t.openBlock(),t.createBlock(z,t.mergeProps({"aem-no-decoration":e.aemNoDecoration,"cq-path":e.cqPath,"get-container-props":l,"get-item-component-props":h,"get-placeholder-props":d,"is-in-editor":t.unref(i)},{...t.unref(c)}),null,16,["aem-no-decoration","cq-path","is-in-editor"]))}});Object.defineProperty(f,"ComponentMapping",{enumerable:!0,get:()=>g.ComponentMapping}),f.AllowedComponentPlaceholder=T,f.AllowedComponentPlaceholderList=$,f.AllowedComponentsContainer=z,f.CompositeEditableProvider=j,f.CompositeModelProvider=O,f.Container=F,f.ContainerPlaceholder=L,f.ContextProvider=w,f.EditableProvider=b,f.MapTo=Q,f.ModelProvider=A,f.Page=Z,f.ResponsiveGrid=K,f.Utils=k,f.componentClassNames=H,f.componentProperties=W,f.withContext=N,f.withEditable=S,f.withModel=D,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
