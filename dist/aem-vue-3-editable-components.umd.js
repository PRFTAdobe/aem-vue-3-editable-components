(function(P,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("@adobe/aem-spa-component-mapping"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","vue","@adobe/aem-spa-component-mapping","@adobe/aem-spa-page-model-manager"],t):(P=typeof globalThis<"u"?globalThis:P||self,t(P.aemVue3EditableComponents={},P.Vue,P.AemSpaComponentMapping,P.AemSpaPageModelManager))})(this,function(P,t,u,C){"use strict";function z(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var E={exports:{}};(function(o,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function n(f){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},n(f)}var s=47,r=46,c=function(d){var p=n(d);if(p!=="string")throw new TypeError("Expected a string, got a ".concat(p))},l=function(d,p){for(var i="",g=0,_=-1,k=0,b,y=0;y<=d.length;++y){if(y<d.length)b=d.charCodeAt(y);else{if(b===s)break;b=s}if(b===s){if(!(_===y-1||k===1))if(_!==y-1&&k===2){if(i.length<2||g!==2||i.charCodeAt(i.length-1)!==r||i.charCodeAt(i.length-2)!==r){if(i.length>2){var B=i.lastIndexOf("/");if(B!==i.length-1){B===-1?(i="",g=0):(i=i.slice(0,B),g=i.length-1-i.lastIndexOf("/")),_=y,k=0;continue}}else if(i.length===2||i.length===1){i="",g=0,_=y,k=0;continue}}p&&(i.length>0?i+="/..":i="..",g=2)}else i.length>0?i+="/"+d.slice(_+1,y):i=d.slice(_+1,y),g=y-_-1;_=y,k=0}else b===r&&k!==-1?++k:k=-1}return i},a=function(d){try{return decodeURIComponent(d)}catch{return d}},m=function(d){c(d);var p=d;if(p.length===0)return".";var i=p.charCodeAt(0)===s,g=p.charCodeAt(p.length-1)===s;return p=a(p),p=l(p,!i),p.length===0&&!i&&(p="."),p.length>0&&g&&(p+="/"),i?"/"+p:p},h=m;e.default=h,o.exports=e.default})(E,E.exports);var U=E.exports;const M=z(U),q={getItemPath(o,e,n){let s=(e==null?void 0:e.length)>0?`${e}/${o}`:o;return n&&(s=(e==null?void 0:e.length)>0?`${e}/jcr:content/${o}`:o),s},connectComponentWithItem(o,e,n,s,r,c){const l=this.getItemPath(n,s,c);return t.h(o,{...e,cqPath:l,containerProps:r(n)})},getChildComponents(o,e,n,s,r,c,l){const a=[];return Object.keys(e).length>0&&n.length>0&&n.forEach(m=>{const h=this.modelToProps(e[m]);if(h&&typeof h.cqType<"u"){const f=l.get(h.cqType);s&&(h.aemNoDecoration=s),f&&a.push(this.connectComponentWithItem(f,h,m,o,r,c))}}),a},getChildPages(o,e){const n=[];return Object.keys(o).length===0||Object.keys(o).forEach(s=>{const r=this.modelToProps(o[s]);if(r&&typeof r.cqType<"u"){const c=e.get(r.cqType);c&&n.push(t.h(c,{...r,cqPath:r.cqPath}))}}),n},getCQPath(o){const{pagePath:e="",itemPath:n="",injectPropsOnInit:s}=o;let{cqPath:r=""}=o;return s&&!r&&(r=M(n?`${e}/jcr:content/${n}`:e),r=r.replace(/^\.$/,"")),r},modelToProps(o){const e=Object.getOwnPropertyNames(o),n={},s=r=>{const c=r.substring(1);return`cq${c.substring(0,1).toUpperCase()}${c.substring(1)}`};return e.forEach(r=>{let c=r;c.startsWith(":")&&(c=s(c)),n[c]=o[r]}),n}},I=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(o){const e=o,n=t.inject("isInEditor",C.AuthoringUtils.isInEditor()),s=t.useSlots(),r=t.useAttrs(),c=t.computed(()=>{const m={},{componentProperties:h}=e;return n&&(m["data-cq-data-path"]=h.cqPath,e.editConfig.resourceType&&(m["data-cq-resource-type"]=e.editConfig.resourceType)),m}),l=t.computed(()=>{var i;const m={},{componentProperties:h}=e,{appliedCssClassNames:f,cqType:d}=h,p=[];return f&&p.push(f),(i=e==null?void 0:e.containerProps)!=null&&i.class&&p.push(e.containerProps.class),d&&(d!=null&&d.endsWith("/container"))&&p.push("aem-editable"),p.length&&(m.class=p.join(" ")),m}),a=t.computed(()=>n&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties)?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return(m,h)=>{var f,d,p,i;return!t.unref(n)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration||e.componentProperties.hasOwnProperty("cqHierarchyType")&&e.componentProperties.cqHierarchyType==="page"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((d=(f=t.unref(s)).default)==null?void 0:d.call(f)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(r),containerProps:e.containerProps})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...c.value,...l.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((i=(p=t.unref(s)).default)==null?void 0:i.call(p)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(r),componentProperties:e.componentProperties})),null,16)),a.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},a.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(o){const e=o,n=t.useSlots(),s=t.useAttrs();return(r,c)=>(t.openBlock(),t.createBlock(I,t.normalizeProps(t.guardReactiveProps({...t.unref(s),componentProperties:{...t.unref(s)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var l,a;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((a=(l=t.unref(n)).default)==null?void 0:a.call(l)[0])))]}),_:1},16))}}),A=t.defineComponent({inheritAttrs:!1,__name:"ModelProvider",props:{cqPath:{type:String},cqForceReload:{type:Boolean,default:!1},injectPropsOnInit:{type:Boolean,default:!1},pagePath:{type:String},itemPath:{type:String}},setup(o){const e=o,n=t.useSlots(),s=t.inject("isInEditor",C.AuthoringUtils.isInEditor()),r=t.reactive({}),c=t.computed(()=>{const{pagePath:h,itemPath:f,injectPropsOnInit:d,cqPath:p}=e;return q.getCQPath({pagePath:h,itemPath:f,injectPropsOnInit:d,cqPath:p})}),l=t.computed(()=>({...t.useAttrs(),...r,cqPath:c.value})),a=h=>{const{pagePath:f,itemPath:d,injectPropsOnInit:p}=e,i=h||e.cqPath||f&&q.getCQPath({pagePath:f,itemPath:d,injectPropsOnInit:p});i&&C.ModelManager.getData({path:i,forceReload:e.cqForceReload}).then(g=>{g&&Object.keys(g).length>0&&(Object.assign(r,q.modelToProps(g)),p&&s&&C.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(g=>{console.error(g)})},m=a.bind(null,c.value);return t.onMounted(()=>{const h=c.value;e.injectPropsOnInit&&a(h),C.ModelManager.addListener(h,m)}),t.onUnmounted(()=>{C.ModelManager.removeListener(e.cqPath,m)}),t.onUpdated(()=>{console.log(`${c.value} has been updated`)}),(h,f)=>{var d,p;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(d=t.unref(n)).default)==null?void 0:p.call(d)[0]),{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=i=>l.value=i)},null,8,["modelValue"])}}}),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(o){const e=o,n=t.useSlots(),s=t.useAttrs(),{modelConfig:r}=t.toRefs(e),c=s.cqForceReload||r.value.forceReload,{injectPropsOnInit:l}=r.value;return(a,m)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(c),"inject-props-on-init":t.unref(l)},{...t.unref(s)}),{default:t.withCtx(()=>{var h,f;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((f=(h=t.unref(n)).default)==null?void 0:f.call(h)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),w=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(o){const e=t.useSlots(),n=t.useAttrs(),s=t.inject("componentMapping",new u.ComponentMapping),r=t.inject("isInEditor",C.AuthoringUtils.isInEditor());return t.provide("isInEditor",r),t.provide("componentMapping",s),(c,l)=>{var a,m;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((m=(a=t.unref(e)).default)==null?void 0:m.call(a)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(n)})),null,16)}}}),N=o=>t.h(w,{},()=>[t.h(o)]),D=(o,e)=>t.h(O,{modelConfig:e},()=>[t.h(o)]),S=(o,e)=>t.h(j,{editConfig:e},()=>[t.h(o)]),x=(o,e,n)=>{const{injectPropsOnInit:s=!0,forceReload:r=!1,...c}=n||{},l={injectPropsOnInit:s,forceReload:r,...c};let a=o;return a=N(D(S(a,e),l)),a},V=u.ComponentMapping.map,G=u.ComponentMapping.get;u.ComponentMapping.map=function(e,n,s={isEmpty:()=>!1},r={}){const{injectPropsOnInit:c=!1,...l}=r||{},a=x(n,s,{injectPropsOnInit:c,...l});return V.call(u.ComponentMapping,e,a),a},u.ComponentMapping.get=G;const Q=o=>(e,n,s={})=>u.ComponentMapping.map(o,e,n,s),W=(o,e,n,s,r,c)=>{let l=[];o&&(l=[o]),e&&l.push(e),n&&l.push(...n.split(" "));const a=s==null?void 0:s.class;return c&&a&&!r&&l.push(a),l},H=o=>({aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},baseCssClass:{type:String,default:o},containerProps:{type:Object,default:()=>{}},cssClassNames:{type:String},id:{type:String}}),J=["data-cq-data-path","data-emptytext"],$=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(o){const e=o;return(n,s)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,J))}}),X=["data-text"],L=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(o){const e=o,n=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(s,r)=>{var c;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(c=e.placeholderProps)==null?void 0:c.placeholderClassNames])},[t.createElementVNode("div",{"data-text":n.value,class:"aem-AllowedComponent--title"},null,8,X),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,l=>(t.openBlock(),t.createBlock($,{key:l.path,"empty-label":l.title,path:l.path},null,8,["empty-label","path"]))),128))],2)}}}),Y=["data-cq-data-path"],T=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(o){const e=o;return(n,s)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,Y))}}),F=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(o){const e=o,n=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",C.AuthoringUtils.isInEditor()),s=t.inject("componentMapping",new u.ComponentMapping),r=t.computed(()=>{let a={};return typeof e.getContainerProps=="function"?a=e.getContainerProps():(a={class:"aem-container"},n&&(a["data-cq-data-path"]=e.cqPath)),a}),c=t.computed(()=>q.getChildComponents(e.cqPath,e.cqItems,e.cqItemsOrder,e.aemNoDecoration,typeof e.getItemComponentProps=="function"?e.getItemComponentProps:()=>({}),!1,s)),l=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(a,m)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps({...r.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(c.value,h=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(h),{key:h.toString()}))),128)),t.unref(n)?(t.openBlock(),t.createBlock(T,t.normalizeProps(t.mergeProps({key:0},l.value)),null,16)):t.createCommentVNode("",!0)],16))}}),R=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},aemNoDecoration:{type:Boolean,default:!1},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(o){const e=o,n=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",C.AuthoringUtils.isInEditor()),s=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),r=t.useAttrs();return(c,l)=>{var a;return t.unref(n)&&e.allowedComponents&&((a=e.allowedComponents)!=null&&a.applicable)?(t.openBlock(),t.createBlock(L,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":s.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):(t.openBlock(),t.createBlock(F,t.mergeProps({key:1,"aem-no-decoration":e.aemNoDecoration,"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps,"is-in-editor":t.unref(n)},{...t.unref(r)}),null,16,["aem-no-decoration","cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props","is-in-editor"]))}}}),Z=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{aemNoDecoration:{type:Boolean,default:!1},cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(o){const e=t.useAttrs(),n=t.inject("isInEditor",C.AuthoringUtils.isInEditor()),s=t.inject("componentMapping",new u.ComponentMapping),r=o,c=t.computed(()=>q.getChildComponents(r.cqPath,r.cqItems,r.cqItemsOrder,r.aemNoDecoration,()=>({}),!0,s)),l=t.computed(()=>q.getChildPages(r.cqChildren,s)),a=t.computed(()=>{const m=["aem-page"];e.cssClassNames&&m.push(...e.cssClassNames.split(" "));const h={class:m.join(" ")};return n&&(h["data-cq-data-path"]=r.cqPath),h});return t.onMounted(()=>{e.title&&(document.title=e.title)}),t.onUpdated(()=>{e.title&&(document.title=e.title)}),(m,h)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(a.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(c.value,f=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(f),{key:f.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.value,f=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(f),{key:f.toString()}))),128))],16))}}),K=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{aemNoDecoration:{type:Boolean,default:!1},cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0},title:{type:String,default:"Layout Container"}},setup(o){const e=o,n=t.useAttrs(),s=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",C.AuthoringUtils.isInEditor()),r=()=>{const a={},m=["aem-container"];return e.gridClassNames&&m.push(e.gridClassNames),a.class=m.join(" "),s&&(a["data-cq-data-path"]=e.cqPath),a},c=()=>{const a={cqPath:e.cqPath},m=["new","section","aem-Grid-newComponent"];return a.placeholderClassNames=m.join(" "),a},l=a=>{const m={};return e.columnClassNames&&e.columnClassNames[a]&&(m.class=e.columnClassNames[a]),m};return(a,m)=>(t.openBlock(),t.createBlock(R,t.mergeProps({"aem-no-decoration":e.aemNoDecoration,"cq-path":e.cqPath,"get-container-props":r,"get-item-component-props":l,"get-placeholder-props":c,"is-in-editor":t.unref(s),title:e.title},{...t.unref(n)}),null,16,["aem-no-decoration","cq-path","is-in-editor","title"]))}});Object.defineProperty(P,"ComponentMapping",{enumerable:!0,get:()=>u.ComponentMapping}),P.AllowedComponentPlaceholder=$,P.AllowedComponentPlaceholderList=L,P.AllowedComponentsContainer=R,P.CompositeEditableProvider=j,P.CompositeModelProvider=O,P.Container=F,P.ContainerPlaceholder=T,P.ContextProvider=w,P.EditableProvider=I,P.MapTo=Q,P.ModelProvider=A,P.Page=Z,P.ResponsiveGrid=K,P.Utils=q,P.componentClassNames=W,P.componentProperties=H,P.withContext=N,P.withEditable=S,P.withModel=D,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
