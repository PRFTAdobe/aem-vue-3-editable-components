(function(P,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("@adobe/aem-spa-component-mapping"),require("vue"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","@adobe/aem-spa-component-mapping","vue","@adobe/aem-spa-page-model-manager"],g):(P=typeof globalThis<"u"?globalThis:P||self,g(P.aemVue3EditableComponents={},P.AemSpaComponentMapping,P.Vue,P.AemSpaPageModelManager))})(this,function(P,g,t,u){"use strict";function R(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var E={exports:{}};(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function c(p){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},c(p)}var a=47,l=46,d=function(o){var s=c(o);if(s!=="string")throw new TypeError("Expected a string, got a ".concat(s))},f=function(o,s){for(var m="",y=0,q=-1,_=0,I,C=0;C<=o.length;++C){if(C<o.length)I=o.charCodeAt(C);else{if(I===a)break;I=a}if(I===a){if(!(q===C-1||_===1))if(q!==C-1&&_===2){if(m.length<2||y!==2||m.charCodeAt(m.length-1)!==l||m.charCodeAt(m.length-2)!==l){if(m.length>2){var b=m.lastIndexOf("/");if(b!==m.length-1){b===-1?(m="",y=0):(m=m.slice(0,b),y=m.length-1-m.lastIndexOf("/")),q=C,_=0;continue}}else if(m.length===2||m.length===1){m="",y=0,q=C,_=0;continue}}s&&(m.length>0?m+="/..":m="..",y=2)}else m.length>0?m+="/"+o.slice(q+1,C):m=o.slice(q+1,C),y=C-q-1;q=C,_=0}else I===l&&_!==-1?++_:_=-1}return m},i=function(o){try{return decodeURIComponent(o)}catch{return o}},h=function(o){d(o);var s=o;if(s.length===0)return".";var m=s.charCodeAt(0)===a,y=s.charCodeAt(s.length-1)===a;return s=i(s),s=f(s,!m),s.length===0&&!m&&(s="."),s.length>0&&y&&(s+="/"),m?"/"+s:s},r=h;e.default=r,n.exports=e.default})(E,E.exports);var U=E.exports;const M=R(U),k={getCQPath(n){const{pagePath:e="",itemPath:c="",injectPropsOnInit:a}=n;let{cqPath:l=""}=n;return a&&!l&&(l=M(c?`${e}/jcr:content/${c}`:e),l=l.replace(/^\.$/,"")),l},modelToProps(n){const e=Object.getOwnPropertyNames(n),c={},a=l=>{const d=l.substring(1);return`cq${d.substring(0,1).toUpperCase()}${d.substring(1)}`};return e.forEach(l=>{let d=l;d.startsWith(":")&&(d=a(d)),c[d]=n[l]}),c}},B=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(n){const e=n,c=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.useSlots(),l=t.useAttrs(),d=t.computed(()=>{const h={},{componentProperties:r}=e;return c&&(h["data-cq-data-path"]=r.cqPath,e.editConfig.resourceType&&(h["data-cq-resource-type"]=e.editConfig.resourceType)),h}),f=t.computed(()=>{var s;const h={},{componentProperties:r}=e,{appliedCssClassNames:p}=r,o=[];return p&&o.push(p),(s=e==null?void 0:e.containerProps)!=null&&s.class&&o.push(e.containerProps.class),o.length&&(h.class=o.join(" ")),h}),i=t.computed(()=>c&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties)?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return(h,r)=>{var p,o,s,m;return!t.unref(c)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((o=(p=t.unref(a)).default)==null?void 0:o.call(p)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(l)})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...d.value,...f.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((m=(s=t.unref(a)).default)==null?void 0:m.call(s)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(l),componentProperties:e.componentProperties})),null,16)),i.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},i.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(n){const e=n,c=t.useSlots(),a=t.useAttrs();return(l,d)=>(t.openBlock(),t.createBlock(B,t.normalizeProps(t.guardReactiveProps({...t.unref(a),componentProperties:{...t.unref(a)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var f,i;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((i=(f=t.unref(c)).default)==null?void 0:i.call(f)[0])))]}),_:1},16))}}),A=t.defineComponent({inheritAttrs:!1,__name:"ModelProvider",props:{cqPath:{type:String},cqForceReload:{type:Boolean,default:!1},injectPropsOnInit:{type:Boolean,default:!1},pagePath:{type:String},itemPath:{type:String}},setup(n){const e=n,c=t.useSlots(),a=t.useAttrs(),l=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),d=t.ref({}),f=()=>{const{pagePath:r,itemPath:p,injectPropsOnInit:o,cqPath:s}=e;return k.getCQPath({pagePath:r,itemPath:p,injectPropsOnInit:o,cqPath:s})},i=r=>{const{pagePath:p,itemPath:o,injectPropsOnInit:s}=e,m=r||e.cqPath||p&&k.getCQPath({pagePath:p,itemPath:o,injectPropsOnInit:s});m&&u.ModelManager.getData({path:m,forceReload:e.cqForceReload}).then(y=>{y&&Object.keys(y).length>0&&(console.log({...a,cqPath:f(),...d.value}),d.value=k.modelToProps(y),console.log({...a,cqPath:f(),...d.value}),s&&l&&u.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(y=>{console.error(y)})},h=i.bind(null,f());return t.onMounted(()=>{const r=f();e.injectPropsOnInit&&i(r),u.ModelManager.addListener(r,h)}),t.onUnmounted(()=>{u.ModelManager.removeListener(e.cqPath,h)}),(r,p)=>{var o,s;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((s=(o=t.unref(c)).default)==null?void 0:s.call(o)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(a),cqPath:f(),...d.value})),null,16)}}}),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(n){const e=n,c=t.useSlots(),a=t.useAttrs(),{modelConfig:l}=t.toRefs(e),d=a.cqForceReload||l.value.forceReload,{injectPropsOnInit:f}=l.value;return(i,h)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(d),"inject-props-on-init":t.unref(f)},{...t.unref(a)}),{default:t.withCtx(()=>{var r,p;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(r=t.unref(c)).default)==null?void 0:p.call(r)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),w=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(n){const e=t.useSlots(),c=t.useAttrs(),a=t.inject("componentMapping",new g.ComponentMapping),l=t.inject("isInEditor",u.AuthoringUtils.isInEditor());return t.provide("isInEditor",l),t.provide("componentMapping",a),(d,f)=>{var i,h;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((h=(i=t.unref(e)).default)==null?void 0:h.call(i)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(c)})),null,16)}}}),N=n=>t.h(w,{},()=>[t.h(n)]),S=(n,e)=>t.h(O,{modelConfig:e},()=>[t.h(n)]),$=(n,e)=>t.h(j,{editConfig:e},()=>[t.h(n)]),x=(n,e,c)=>{const{injectPropsOnInit:a=!0,forceReload:l=!1,...d}=c||{},f={injectPropsOnInit:a,forceReload:l,...d};let i=n;return i=N(S($(i,e),f)),i},V=g.ComponentMapping.map,G=g.ComponentMapping.get;g.ComponentMapping.map=function(e,c,a={isEmpty:()=>!1},l={}){const{injectPropsOnInit:d=!1,...f}=l||{},i=x(c,a,{injectPropsOnInit:d,...f});return V.call(g.ComponentMapping,e,i),i},g.ComponentMapping.get=G;const Q=n=>(e,c,a={})=>g.ComponentMapping.map(n,e,c,a),W=(n,e,c,a)=>{let l=[];n&&(l=[n]),e&&l.push(e);const d=c==null?void 0:c.class;return d&&!a&&l.push(d),l},H=n=>({appliedCssClassNames:{type:String},baseCssClass:{type:String,default:n},containerProps:{type:Object,default:()=>{}},id:{type:String}}),J=["data-cq-data-path","data-emptytext"],L=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(n){const e=n;return(c,a)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,J))}}),X=["data-text"],T=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(n){const e=n,c=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(a,l)=>{var d;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(d=e.placeholderProps)==null?void 0:d.placeholderClassNames])},[t.createElementVNode("div",{"data-text":c.value,class:"aem-AllowedComponent--title"},null,8,X),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,f=>(t.openBlock(),t.createBlock(L,{key:f.path,"empty-label":f.title,path:f.path},null,8,["empty-label","path"]))),128))],2)}}}),Y=["data-cq-data-path"],D=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(n){const e=n;return(c,a)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,Y))}}),F=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(n){const e=n,c=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.inject("componentMapping",new g.ComponentMapping),l=r=>{var p;return((p=e.cqPath)==null?void 0:p.length)>0?`${e.cqPath}/${r}`:r},d=(r,p,o)=>{const s=l(o);return t.h(r,{...p,cqPath:s,containerProps:typeof e.getItemComponentProps=="function"?e.getItemComponentProps(o):{}})},f=t.computed(()=>{let r={};return typeof e.getContainerProps=="function"?r=e.getContainerProps():(r={class:"aem-container"},c&&(r["data-cq-data-path"]=e.cqPath)),r}),i=t.computed(()=>{const r=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(p=>{const o=k.modelToProps(e.cqItems[p]);if(o&&typeof o.cqType<"u"){const s=a.get(o.cqType);s&&r.push(d(s,o,p))}}),r}),h=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(r,p)=>!t.unref(c)&&e.aemNoDecoration?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:0},t.renderList(i.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...f.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),t.unref(c)?(t.openBlock(),t.createBlock(D,t.normalizeProps(t.mergeProps({key:0},h.value)),null,16)):t.createCommentVNode("",!0)],16))}}),z=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(n){const e=n,c=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),l=t.useAttrs();return(d,f)=>{var i;return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(c)&&e.allowedComponents&&((i=e.allowedComponents)!=null&&i.applicable)?(t.openBlock(),t.createBlock(T,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":a.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):t.createCommentVNode("",!0),t.createVNode(F,t.mergeProps({"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps},{...t.unref(l)}),null,16,["cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props"])],64)}}}),Z=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(n){const e=n,c=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.inject("componentMapping",new g.ComponentMapping),l=r=>{var p;return((p=e.cqPath)==null?void 0:p.length)>0?`${e.cqPath}/jcr:content/${r}`:r},d=(r,p,o)=>{const s=l(o);return t.h(r,{...p,cqPath:s,containerProps:{}})},f=t.computed(()=>{const r=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(p=>{const o=k.modelToProps(e.cqItems[p]);if(o&&typeof o.cqType<"u"){const s=a.get(o.cqType);s&&r.push(d(s,o,p))}}),r}),i=t.computed(()=>{const r=[];return Object.keys(e.cqChildren).length===0||Object.keys(e.cqChildren).forEach(p=>{const o=k.modelToProps(e.cqChildren[p]);if(o&&typeof o.cqType<"u"){const s=a.get(o.cqType);s&&r.push(t.h(s,{...o,cqPath:o.cqPath}))}}),r}),h=t.computed(()=>{const r={class:"aem-page"};return c&&(r["data-cq-data-path"]=e.cqPath),r});return(r,p)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(h.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(f.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128))],16))}}),K=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0}},setup(n){const e=n,c=t.useAttrs(),a=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),l=()=>{const i={},h=["aem-container"];return e.gridClassNames&&h.push(e.gridClassNames),i.class=h.join(" "),a&&(i["data-cq-data-path"]=e.cqPath),i},d=()=>{const i={cqPath:e.cqPath},h=["new","section","aem-Grid-newComponent"];return i.placeholderClassNames=h.join(" "),i},f=i=>{const h={};return e.columnClassNames&&e.columnClassNames[i]&&(h.class=e.columnClassNames[i]),h};return(i,h)=>(t.openBlock(),t.createBlock(z,t.mergeProps({"cq-path":e.cqPath,"get-container-props":l,"get-item-component-props":f,"get-placeholder-props":d,"is-in-editor":t.unref(a)},{...t.unref(c)}),null,16,["cq-path","is-in-editor"]))}});Object.defineProperty(P,"ComponentMapping",{enumerable:!0,get:()=>g.ComponentMapping}),P.AllowedComponentPlaceholder=L,P.AllowedComponentPlaceholderList=T,P.AllowedComponentsContainer=z,P.CompositeEditableProvider=j,P.CompositeModelProvider=O,P.Container=F,P.ContainerPlaceholder=D,P.ContextProvider=w,P.EditableProvider=B,P.MapTo=Q,P.ModelProvider=A,P.Page=Z,P.ResponsiveGrid=K,P.Utils=k,P.componentClassNames=W,P.componentProperties=H,P.withContext=N,P.withEditable=$,P.withModel=S,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
