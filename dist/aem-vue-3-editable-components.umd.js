(function(P,y){typeof exports=="object"&&typeof module<"u"?y(exports,require("@adobe/aem-spa-component-mapping"),require("vue"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","@adobe/aem-spa-component-mapping","vue","@adobe/aem-spa-page-model-manager"],y):(P=typeof globalThis<"u"?globalThis:P||self,y(P.aemVue3EditableComponents={},P.AemSpaComponentMapping,P.Vue,P.AemSpaPageModelManager))})(this,function(P,y,t,u){"use strict";function F(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var E={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function s(c){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},s(c)}var a=47,i=46,d=function(o){var n=s(o);if(n!=="string")throw new TypeError("Expected a string, got a ".concat(n))},f=function(o,n){for(var l="",g=0,q=-1,_=0,I,C=0;C<=o.length;++C){if(C<o.length)I=o.charCodeAt(C);else{if(I===a)break;I=a}if(I===a){if(!(q===C-1||_===1))if(q!==C-1&&_===2){if(l.length<2||g!==2||l.charCodeAt(l.length-1)!==i||l.charCodeAt(l.length-2)!==i){if(l.length>2){var b=l.lastIndexOf("/");if(b!==l.length-1){b===-1?(l="",g=0):(l=l.slice(0,b),g=l.length-1-l.lastIndexOf("/")),q=C,_=0;continue}}else if(l.length===2||l.length===1){l="",g=0,q=C,_=0;continue}}n&&(l.length>0?l+="/..":l="..",g=2)}else l.length>0?l+="/"+o.slice(q+1,C):l=o.slice(q+1,C),g=C-q-1;q=C,_=0}else I===i&&_!==-1?++_:_=-1}return l},p=function(o){try{return decodeURIComponent(o)}catch{return o}},h=function(o){d(o);var n=o;if(n.length===0)return".";var l=n.charCodeAt(0)===a,g=n.charCodeAt(n.length-1)===a;return n=p(n),n=f(n,!l),n.length===0&&!l&&(n="."),n.length>0&&g&&(n+="/"),l?"/"+n:n},m=h;e.default=m,r.exports=e.default})(E,E.exports);var U=E.exports;const M=F(U),k={getCQPath(r){const{pagePath:e="",itemPath:s="",injectPropsOnInit:a}=r;let{cqPath:i=""}=r;return a&&!i&&(i=M(s?`${e}/jcr:content/${s}`:e),i=i.replace(/^\.$/,"")),i},modelToProps(r){const e=Object.getOwnPropertyNames(r),s={},a=i=>{const d=i.substring(1);return`cq${d.substring(0,1).toUpperCase()}${d.substring(1)}`};return e.forEach(i=>{let d=i;d.startsWith(":")&&(d=a(d)),s[d]=r[i]}),s}},B=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(r){const e=r,s=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.useSlots(),i=t.useAttrs(),d=t.computed(()=>{const h={},{componentProperties:m}=e;return s&&(h["data-cq-data-path"]=m.cqPath,e.editConfig.resourceType&&(h["data-cq-resource-type"]=e.editConfig.resourceType)),h}),f=t.computed(()=>{var n;const h={},{componentProperties:m}=e,{appliedCssClassNames:c}=m,o=[];return c&&o.push(c),(n=e==null?void 0:e.containerProps)!=null&&n.class&&o.push(e.containerProps.class),o.length&&(h.class=o.join(" ")),h}),p=t.computed(()=>s&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties)?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return(h,m)=>{var c,o,n,l;return!t.unref(s)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration||e.componentProperties.hasOwnProperty("cqHierarchyType")&&e.componentProperties.cqHierarchyType==="page"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((o=(c=t.unref(a)).default)==null?void 0:o.call(c)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(i),containerProps:e.containerProps})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...d.value,...f.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((l=(n=t.unref(a)).default)==null?void 0:l.call(n)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(i),componentProperties:e.componentProperties})),null,16)),p.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},p.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(r){const e=r,s=t.useSlots(),a=t.useAttrs();return(i,d)=>(t.openBlock(),t.createBlock(B,t.normalizeProps(t.guardReactiveProps({...t.unref(a),componentProperties:{...t.unref(a)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var f,p;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(f=t.unref(s)).default)==null?void 0:p.call(f)[0])))]}),_:1},16))}}),A=t.defineComponent({inheritAttrs:!1,__name:"ModelProvider",props:{cqPath:{type:String},cqForceReload:{type:Boolean,default:!1},injectPropsOnInit:{type:Boolean,default:!1},pagePath:{type:String},itemPath:{type:String}},setup(r){const e=r,s=t.useSlots(),a=t.useAttrs(),i=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),d=t.ref(a),f=()=>{const{pagePath:m,itemPath:c,injectPropsOnInit:o,cqPath:n}=e;return k.getCQPath({pagePath:m,itemPath:c,injectPropsOnInit:o,cqPath:n})},p=m=>{const{pagePath:c,itemPath:o,injectPropsOnInit:n}=e,l=m||e.cqPath||c&&k.getCQPath({pagePath:c,itemPath:o,injectPropsOnInit:n});l&&u.ModelManager.getData({path:l,forceReload:e.cqForceReload}).then(g=>{g&&Object.keys(g).length>0&&(Object.assign(d.value,k.modelToProps(g)),n&&i&&u.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(g=>{console.error(g)})},h=p.bind(null,f());return t.onMounted(()=>{const m=f();e.injectPropsOnInit&&p(m),u.ModelManager.addListener(m,h)}),t.onUnmounted(()=>{u.ModelManager.removeListener(e.cqPath,h)}),(m,c)=>{var o,n;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((n=(o=t.unref(s)).default)==null?void 0:n.call(o)[0]),t.normalizeProps(t.guardReactiveProps({cqPath:f(),...d.value})),null,16)}}}),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(r){const e=r,s=t.useSlots(),a=t.useAttrs(),{modelConfig:i}=t.toRefs(e),d=a.cqForceReload||i.value.forceReload,{injectPropsOnInit:f}=i.value;return(p,h)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(d),"inject-props-on-init":t.unref(f)},{...t.unref(a)}),{default:t.withCtx(()=>{var m,c;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((c=(m=t.unref(s)).default)==null?void 0:c.call(m)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),N=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(r){const e=t.useSlots(),s=t.useAttrs(),a=t.inject("componentMapping",new y.ComponentMapping),i=t.inject("isInEditor",u.AuthoringUtils.isInEditor());return t.provide("isInEditor",i),t.provide("componentMapping",a),(d,f)=>{var p,h;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((h=(p=t.unref(e)).default)==null?void 0:h.call(p)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(s)})),null,16)}}}),w=r=>t.h(N,{},()=>[t.h(r)]),D=(r,e)=>t.h(O,{modelConfig:e},()=>[t.h(r)]),T=(r,e)=>t.h(j,{editConfig:e},()=>[t.h(r)]),x=(r,e,s)=>{const{injectPropsOnInit:a=!0,forceReload:i=!1,...d}=s||{},f={injectPropsOnInit:a,forceReload:i,...d};let p=r;return p=w(D(T(p,e),f)),p},G=y.ComponentMapping.map,V=y.ComponentMapping.get;y.ComponentMapping.map=function(e,s,a={isEmpty:()=>!1},i={}){const{injectPropsOnInit:d=!1,...f}=i||{},p=x(s,a,{injectPropsOnInit:d,...f});return G.call(y.ComponentMapping,e,p),p},y.ComponentMapping.get=V;const Q=r=>(e,s,a={})=>y.ComponentMapping.map(r,e,s,a),H=(r,e,s,a,i)=>{let d=[];r&&(d=[r]),e&&d.push(e);const f=s==null?void 0:s.class;return i&&f&&!a&&d.push(f),d},W=r=>({aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},baseCssClass:{type:String,default:r},containerProps:{type:Object,default:()=>{}},id:{type:String}}),J=["data-cq-data-path","data-emptytext"],$=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(r){const e=r;return(s,a)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,J))}}),X=["data-text"],S=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(r){const e=r,s=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(a,i)=>{var d;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(d=e.placeholderProps)==null?void 0:d.placeholderClassNames])},[t.createElementVNode("div",{"data-text":s.value,class:"aem-AllowedComponent--title"},null,8,X),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,f=>(t.openBlock(),t.createBlock($,{key:f.path,"empty-label":f.title,path:f.path},null,8,["empty-label","path"]))),128))],2)}}}),Y=["data-cq-data-path"],L=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(r){const e=r;return(s,a)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,Y))}}),R=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(r){const e=r,s=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.inject("componentMapping",new y.ComponentMapping),i=m=>{var c;return((c=e.cqPath)==null?void 0:c.length)>0?`${e.cqPath}/${m}`:m},d=(m,c,o)=>{const n=i(o);return t.h(m,{...c,cqPath:n,containerProps:typeof e.getItemComponentProps=="function"?e.getItemComponentProps(o):{}})},f=t.computed(()=>{let m={};return typeof e.getContainerProps=="function"?m=e.getContainerProps():(m={class:"aem-container"},s&&(m["data-cq-data-path"]=e.cqPath)),m}),p=t.computed(()=>{const m=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(c=>{const o=k.modelToProps(e.cqItems[c]);if(o&&typeof o.cqType<"u"){const n=a.get(o.cqType);e.aemNoDecoration&&(o.aemNoDecoration=e.aemNoDecoration),n&&m.push(d(n,o,c))}}),m}),h=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(m,c)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps({...f.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),t.unref(s)?(t.openBlock(),t.createBlock(L,t.normalizeProps(t.mergeProps({key:0},h.value)),null,16)):t.createCommentVNode("",!0)],16))}}),z=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},aemNoDecoration:{type:Boolean,default:!1},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(r){const e=r,s=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),a=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),i=t.useAttrs();return(d,f)=>{var p;return t.unref(s)&&e.allowedComponents&&((p=e.allowedComponents)!=null&&p.applicable)?(t.openBlock(),t.createBlock(S,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":a.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):(t.openBlock(),t.createBlock(R,t.mergeProps({key:1,"aem-no-decoration":e.aemNoDecoration,"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps,"is-in-editor":t.unref(s)},{...t.unref(i)}),null,16,["aem-no-decoration","cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props","is-in-editor"]))}}}),Z=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(r){const e=r,s=t.useAttrs(),a=t.inject("isInEditor",u.AuthoringUtils.isInEditor()),i=t.inject("componentMapping",new y.ComponentMapping),d=c=>{var o;return((o=e.cqPath)==null?void 0:o.length)>0?`${e.cqPath}/jcr:content/${c}`:c},f=(c,o,n)=>{const l=d(n);return t.h(c,{...o,cqPath:l,containerProps:{}})},p=t.computed(()=>{const c=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(o=>{const n=k.modelToProps(e.cqItems[o]);if(n&&typeof n.cqType<"u"){const l=i.get(n.cqType);l&&c.push(f(l,n,o))}}),c}),h=t.computed(()=>{const c=[];return Object.keys(e.cqChildren).length===0||Object.keys(e.cqChildren).forEach(o=>{const n=k.modelToProps(e.cqChildren[o]);if(n&&typeof n.cqType<"u"){const l=i.get(n.cqType);l&&c.push(t.h(l,{...n,cqPath:n.cqPath}))}}),c}),m=t.computed(()=>{const c=["aem-page"];s.cssClassNames&&c.push(...s.cssClassNames.split(" "));const o={class:c.join(" ")};return a&&(o["data-cq-data-path"]=e.cqPath),o});return(c,o)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(m.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(p.value,n=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n),{key:n.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(h.value,n=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n),{key:n.toString()}))),128))],16))}}),K=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{aemNoDecoration:{type:Boolean,default:!1},cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0}},setup(r){const e=r,s=t.useAttrs(),a=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",u.AuthoringUtils.isInEditor()),i=()=>{const p={},h=["aem-container"];return e.gridClassNames&&h.push(e.gridClassNames),p.class=h.join(" "),a&&(p["data-cq-data-path"]=e.cqPath),p},d=()=>{const p={cqPath:e.cqPath},h=["new","section","aem-Grid-newComponent"];return p.placeholderClassNames=h.join(" "),p},f=p=>{const h={};return e.columnClassNames&&e.columnClassNames[p]&&(h.class=e.columnClassNames[p]),h};return(p,h)=>(t.openBlock(),t.createBlock(z,t.mergeProps({"aem-no-decoration":e.aemNoDecoration,"cq-path":e.cqPath,"get-container-props":i,"get-item-component-props":f,"get-placeholder-props":d,"is-in-editor":t.unref(a)},{...t.unref(s)}),null,16,["aem-no-decoration","cq-path","is-in-editor"]))}});Object.defineProperty(P,"ComponentMapping",{enumerable:!0,get:()=>y.ComponentMapping}),P.AllowedComponentPlaceholder=$,P.AllowedComponentPlaceholderList=S,P.AllowedComponentsContainer=z,P.CompositeEditableProvider=j,P.CompositeModelProvider=O,P.Container=R,P.ContainerPlaceholder=L,P.ContextProvider=N,P.EditableProvider=B,P.MapTo=Q,P.ModelProvider=A,P.Page=Z,P.ResponsiveGrid=K,P.Utils=k,P.componentClassNames=H,P.componentProperties=W,P.withContext=w,P.withEditable=T,P.withModel=D,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
