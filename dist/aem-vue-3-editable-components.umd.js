(function(f,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("@adobe/aem-spa-component-mapping"),require("vue"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","@adobe/aem-spa-component-mapping","vue","@adobe/aem-spa-page-model-manager"],g):(f=typeof globalThis<"u"?globalThis:f||self,g(f.aemVue3EditableComponents={},f.AemSpaComponentMapping,f.Vue,f.AemSpaPageModelManager))})(this,function(f,g,t,q){"use strict";function R(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var b={exports:{}};(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function c(i){"@babel/helpers - typeof";return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},c(i)}var l=47,a=46,m=function(o){var r=c(o);if(r!=="string")throw new TypeError("Expected a string, got a ".concat(r))},h=function(o,r){for(var p="",y=0,C=-1,_=0,E,u=0;u<=o.length;++u){if(u<o.length)E=o.charCodeAt(u);else{if(E===l)break;E=l}if(E===l){if(!(C===u-1||_===1))if(C!==u-1&&_===2){if(p.length<2||y!==2||p.charCodeAt(p.length-1)!==a||p.charCodeAt(p.length-2)!==a){if(p.length>2){var I=p.lastIndexOf("/");if(I!==p.length-1){I===-1?(p="",y=0):(p=p.slice(0,I),y=p.length-1-p.lastIndexOf("/")),C=u,_=0;continue}}else if(p.length===2||p.length===1){p="",y=0,C=u,_=0;continue}}r&&(p.length>0?p+="/..":p="..",y=2)}else p.length>0?p+="/"+o.slice(C+1,u):p=o.slice(C+1,u),y=u-C-1;C=u,_=0}else E===a&&_!==-1?++_:_=-1}return p},d=function(o){try{return decodeURIComponent(o)}catch{return o}},P=function(o){m(o);var r=o;if(r.length===0)return".";var p=r.charCodeAt(0)===l,y=r.charCodeAt(r.length-1)===l;return r=d(r),r=h(r,!p),r.length===0&&!p&&(r="."),r.length>0&&y&&(r+="/"),p?"/"+r:r},s=P;e.default=s,n.exports=e.default})(b,b.exports);var U=b.exports;const M=R(U),k={getCQPath(n){const{pagePath:e="",itemPath:c="",injectPropsOnInit:l}=n;let{cqPath:a=""}=n;return l&&!a&&(a=M(c?`${e}/jcr:content/${c}`:e),a=a.replace(/^\.$/,"")),a},modelToProps(n){const e=Object.getOwnPropertyNames(n),c={},l=a=>{const m=a.substring(1);return`cq${m.substring(0,1).toUpperCase()}${m.substring(1)}`};return e.forEach(a=>{let m=a;m.startsWith(":")&&(m=l(m)),c[m]=n[a]}),c}},B=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(n){const e=n,c=t.inject("isInEditor",q.AuthoringUtils.isInEditor()),l=t.useSlots(),a=t.useAttrs(),m=t.computed(()=>{const s={},{componentProperties:i}=e;return c&&(s["data-cq-data-path"]=i.cqPath,e.editConfig.resourceType&&(s["data-cq-resource-type"]=e.editConfig.resourceType)),s}),h=t.computed(()=>{var p;const s={},{componentProperties:i}=e,{appliedCssClassNames:o}=i,r=[];return o&&r.push(o),(p=e==null?void 0:e.containerProps)!=null&&p.class&&r.push(e.containerProps.class),r.length&&(s.class=r.join(" ")),s}),d=c&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties),P=t.computed(()=>d?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return t.onMounted(()=>{console.log("EditableProvider mounted properties: ",e),console.log("EditableProvider mounted attributes: ",a)}),t.onUpdated(()=>{console.log("EditableProvider updated properties: ",e),console.log("EditableProvider updated attributes: ",a)}),(s,i)=>{var o,r,p,y;return!t.unref(c)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((r=(o=t.unref(l)).default)==null?void 0:r.call(o)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(a)})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...m.value,...h.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((y=(p=t.unref(l)).default)==null?void 0:y.call(p)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(a),componentProperties:e.componentProperties})),null,16)),P.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},P.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(n){const e=n,c=t.useSlots(),l=t.useAttrs();return(a,m)=>(t.openBlock(),t.createBlock(B,t.normalizeProps(t.guardReactiveProps({...t.unref(l),componentProperties:{...t.unref(l)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var h,d;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((d=(h=t.unref(c)).default)==null?void 0:d.call(h)[0])))]}),_:1},16))}}),A=t.defineComponent({inheritAttrs:!1,__name:"ModelProvider",props:{cqPath:{type:String},cqForceReload:{type:Boolean,default:!1},injectPropsOnInit:{type:Boolean,default:!1},pagePath:{type:String},itemPath:{type:String}},setup(n){const e=n,c=t.useSlots(),l=t.useAttrs(),a=t.inject("isInEditor",q.AuthoringUtils.isInEditor()),m=t.ref({}),h=()=>{const{pagePath:i,itemPath:o,injectPropsOnInit:r,cqPath:p}=e;return k.getCQPath({pagePath:i,itemPath:o,injectPropsOnInit:r,cqPath:p})},d=t.computed(()=>({...l,cqPath:h(),...m.value})),P=i=>{const{pagePath:o,itemPath:r,injectPropsOnInit:p}=e,y=i||e.cqPath||o&&k.getCQPath({pagePath:o,itemPath:r,injectPropsOnInit:p});y&&q.ModelManager.getData({path:y,forceReload:e.cqForceReload}).then(C=>{C&&Object.keys(C).length>0&&(m.value=k.modelToProps(C),p&&a&&q.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(C=>{console.error(C)})},s=P.bind(null,h());return t.onMounted(()=>{const i=h();e.injectPropsOnInit&&P(i),q.ModelManager.addListener(i,s)}),t.onUnmounted(()=>{q.ModelManager.removeListener(e.cqPath,s)}),(i,o)=>{var r,p;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(r=t.unref(c)).default)==null?void 0:p.call(r)[0]),t.normalizeProps(t.guardReactiveProps(d.value)),null,16)}}}),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(n){const e=n,c=t.useSlots(),l=t.useAttrs(),{modelConfig:a}=t.toRefs(e),m=l.cqForceReload||a.value.forceReload,{injectPropsOnInit:h}=a.value;return(d,P)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(m),"inject-props-on-init":t.unref(h)},{...t.unref(l)}),{default:t.withCtx(()=>{var s,i;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((i=(s=t.unref(c)).default)==null?void 0:i.call(s)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),w=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(n){const e=t.useSlots(),c=t.useAttrs(),l=t.inject("componentMapping",new g.ComponentMapping),a=t.inject("isInEditor",q.AuthoringUtils.isInEditor());return t.provide("isInEditor",a),t.provide("componentMapping",l),(m,h)=>{var d,P;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((P=(d=t.unref(e)).default)==null?void 0:P.call(d)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(c)})),null,16)}}}),N=n=>t.h(w,{},()=>[t.h(n)]),S=(n,e)=>t.h(O,{modelConfig:e},()=>[t.h(n)]),$=(n,e)=>t.h(j,{editConfig:e},()=>[t.h(n)]),x=(n,e,c)=>{const{injectPropsOnInit:l=!0,forceReload:a=!1,...m}=c||{},h={injectPropsOnInit:l,forceReload:a,...m};let d=n;return d=N(S($(d,e),h)),d},V=g.ComponentMapping.map,G=g.ComponentMapping.get;g.ComponentMapping.map=function(e,c,l={isEmpty:()=>!1},a={}){const{injectPropsOnInit:m=!1,...h}=a||{},d=x(c,l,{injectPropsOnInit:m,...h});return V.call(g.ComponentMapping,e,d),d},g.ComponentMapping.get=G;const Q=n=>(e,c,l={})=>g.ComponentMapping.map(n,e,c,l),W=(n,e,c,l)=>{let a=[];n&&(a=[n]),e&&a.push(e);const m=c==null?void 0:c.class;return m&&!l&&a.push(m),a},H=n=>({appliedCssClassNames:{type:String},baseCssClass:{type:String,default:n},containerProps:{type:Object,default:()=>{}},id:{type:String}}),J=["data-cq-data-path","data-emptytext"],L=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(n){const e=n;return(c,l)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,J))}}),X=["data-text"],T=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(n){const e=n,c=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(l,a)=>{var m;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(m=e.placeholderProps)==null?void 0:m.placeholderClassNames])},[t.createElementVNode("div",{"data-text":c.value,class:"aem-AllowedComponent--title"},null,8,X),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,h=>(t.openBlock(),t.createBlock(L,{key:h.path,"empty-label":h.title,path:h.path},null,8,["empty-label","path"]))),128))],2)}}}),Y=["data-cq-data-path"],D=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(n){const e=n;return(c,l)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,Y))}}),F=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(n){const e=n,c=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",q.AuthoringUtils.isInEditor()),l=t.inject("componentMapping",new g.ComponentMapping),a=s=>{var i;return((i=e.cqPath)==null?void 0:i.length)>0?`${e.cqPath}/${s}`:s},m=(s,i,o)=>{const r=a(o);return t.h(s,{...i,cqPath:r,containerProps:typeof e.getItemComponentProps=="function"?e.getItemComponentProps(o):{}})},h=t.computed(()=>{let s={};return typeof e.getContainerProps=="function"?s=e.getContainerProps():(s={class:"aem-container"},c&&(s["data-cq-data-path"]=e.cqPath)),s}),d=t.computed(()=>{const s=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(i=>{const o=k.modelToProps(e.cqItems[i]);if(o&&typeof o.cqType<"u"){const r=l.get(o.cqType);r&&s.push(m(r,o,i))}}),s}),P=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(s,i)=>!t.unref(c)&&e.aemNoDecoration?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:0},t.renderList(d.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...h.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(d.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),t.unref(c)?(t.openBlock(),t.createBlock(D,t.normalizeProps(t.mergeProps({key:0},P.value)),null,16)):t.createCommentVNode("",!0)],16))}}),z=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(n){const e=n,c=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",q.AuthoringUtils.isInEditor()),l=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),a=t.useAttrs();return(m,h)=>{var d;return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(c)&&e.allowedComponents&&((d=e.allowedComponents)!=null&&d.applicable)?(t.openBlock(),t.createBlock(T,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":l.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):t.createCommentVNode("",!0),t.createVNode(F,t.mergeProps({"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps},{...t.unref(a)}),null,16,["cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props"])],64)}}}),Z=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(n){const e=n,c=t.inject("isInEditor",q.AuthoringUtils.isInEditor()),l=t.inject("componentMapping",new g.ComponentMapping),a=s=>{var i;return((i=e.cqPath)==null?void 0:i.length)>0?`${e.cqPath}/jcr:content/${s}`:s},m=(s,i,o)=>{const r=a(o);return t.h(s,{...i,cqPath:r,containerProps:{}})},h=t.computed(()=>{const s=[];return Object.keys(e.cqItems).length>0&&e.cqItemsOrder.length>0&&e.cqItemsOrder.forEach(i=>{const o=k.modelToProps(e.cqItems[i]);if(o&&typeof o.cqType<"u"){const r=l.get(o.cqType);r&&s.push(m(r,o,i))}}),s}),d=t.computed(()=>{const s=[];return Object.keys(e.cqChildren).length===0||Object.keys(e.cqChildren).forEach(i=>{const o=k.modelToProps(e.cqChildren[i]);if(o&&typeof o.cqType<"u"){const r=l.get(o.cqType);r&&s.push(t.h(r,{...o,cqPath:o.cqPath}))}}),s}),P=t.computed(()=>{const s={class:"aem-page"};return c&&(s["data-cq-data-path"]=e.cqPath),s});return(s,i)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(P.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(h.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(d.value,o=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o),{key:o.toString()}))),128))],16))}}),K=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0}},setup(n){const e=n,c=t.useAttrs(),l=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",q.AuthoringUtils.isInEditor()),a=()=>{const d={},P=["aem-container"];return e.gridClassNames&&P.push(e.gridClassNames),d.class=P.join(" "),l&&(d["data-cq-data-path"]=e.cqPath),d},m=()=>{const d={cqPath:e.cqPath},P=["new","section","aem-Grid-newComponent"];return d.placeholderClassNames=P.join(" "),d},h=d=>{const P={};return e.columnClassNames&&e.columnClassNames[d]&&(P.class=e.columnClassNames[d]),P};return(d,P)=>(t.openBlock(),t.createBlock(z,t.mergeProps({"cq-path":e.cqPath,"get-container-props":a,"get-item-component-props":h,"get-placeholder-props":m,"is-in-editor":t.unref(l)},{...t.unref(c)}),null,16,["cq-path","is-in-editor"]))}});Object.defineProperty(f,"ComponentMapping",{enumerable:!0,get:()=>g.ComponentMapping}),f.AllowedComponentPlaceholder=L,f.AllowedComponentPlaceholderList=T,f.AllowedComponentsContainer=z,f.CompositeEditableProvider=j,f.CompositeModelProvider=O,f.Container=F,f.ContainerPlaceholder=D,f.ContextProvider=w,f.EditableProvider=B,f.MapTo=Q,f.ModelProvider=A,f.Page=Z,f.ResponsiveGrid=K,f.Utils=k,f.componentClassNames=W,f.componentProperties=H,f.withContext=N,f.withEditable=$,f.withModel=S,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
