(function(m,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("@adobe/aem-spa-component-mapping"),require("@adobe/aem-spa-page-model-manager")):typeof define=="function"&&define.amd?define(["exports","vue","@adobe/aem-spa-component-mapping","@adobe/aem-spa-page-model-manager"],t):(m=typeof globalThis<"u"?globalThis:m||self,t(m.aemVue3EditableComponents={},m.Vue,m.AemSpaComponentMapping,m.AemSpaPageModelManager))})(this,function(m,t,u,y){"use strict";function F(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var E={exports:{}};(function(o,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;function n(h){"@babel/helpers - typeof";return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},n(h)}var r=47,s=46,c=function(f){var d=n(f);if(d!=="string")throw new TypeError("Expected a string, got a ".concat(d))},i=function(f,d){for(var p="",C=0,_=-1,q=0,b,g=0;g<=f.length;++g){if(g<f.length)b=f.charCodeAt(g);else{if(b===r)break;b=r}if(b===r){if(!(_===g-1||q===1))if(_!==g-1&&q===2){if(p.length<2||C!==2||p.charCodeAt(p.length-1)!==s||p.charCodeAt(p.length-2)!==s){if(p.length>2){var B=p.lastIndexOf("/");if(B!==p.length-1){B===-1?(p="",C=0):(p=p.slice(0,B),C=p.length-1-p.lastIndexOf("/")),_=g,q=0;continue}}else if(p.length===2||p.length===1){p="",C=0,_=g,q=0;continue}}d&&(p.length>0?p+="/..":p="..",C=2)}else p.length>0?p+="/"+f.slice(_+1,g):p=f.slice(_+1,g),C=g-_-1;_=g,q=0}else b===s&&q!==-1?++q:q=-1}return p},a=function(f){try{return decodeURIComponent(f)}catch{return f}},l=function(f){c(f);var d=f;if(d.length===0)return".";var p=d.charCodeAt(0)===r,C=d.charCodeAt(d.length-1)===r;return d=a(d),d=i(d,!p),d.length===0&&!p&&(d="."),d.length>0&&C&&(d+="/"),p?"/"+d:d},P=l;e.default=P,o.exports=e.default})(E,E.exports);var M=E.exports;const U=F(M),k={getItemPath(o,e,n){let r=(e==null?void 0:e.length)>0?`${e}/${o}`:o;return n&&(r=(e==null?void 0:e.length)>0?`${e}/jcr:content/${o}`:o),r},connectComponentWithItem(o,e,n,r,s,c){const i=this.getItemPath(n,r,c);return t.h(o,{...e,cqPath:i,containerProps:s(n)})},getChildComponents(o,e,n,r,s,c,i){const a=[];return Object.keys(e).length>0&&n.length>0&&n.forEach(l=>{const P=this.modelToProps(e[l]);if(P&&typeof P.cqType<"u"){const h=i.get(P.cqType);r&&(P.aemNoDecoration=r),h&&a.push(this.connectComponentWithItem(h,P,l,o,s,c))}}),a},getChildPages(o,e){const n=[];return Object.keys(o).length===0||Object.keys(o).forEach(r=>{const s=this.modelToProps(o[r]);if(s&&typeof s.cqType<"u"){const c=e.get(s.cqType);c&&n.push(t.h(c,{...s,cqPath:s.cqPath}))}}),n},getCQPath(o){const{pagePath:e="",itemPath:n="",injectPropsOnInit:r}=o;let{cqPath:s=""}=o;return r&&!s&&(s=U(n?`${e}/jcr:content/${n}`:e),s=s.replace(/^\.$/,"")),s},modelToProps(o){const e=Object.getOwnPropertyNames(o),n={},r=s=>{const c=s.substring(1);return`cq${c.substring(0,1).toUpperCase()}${c.substring(1)}`};return e.forEach(s=>{let c=s;c.startsWith(":")&&(c=r(c)),n[c]=o[s]}),n}},I=t.defineComponent({inheritAttrs:!1,__name:"EditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})},componentProperties:{type:Object,default:()=>({})},containerProps:{type:Object}},setup(o){const e=o,n=t.inject("isInEditor",y.AuthoringUtils.isInEditor()),r=t.useSlots(),s=t.useAttrs(),c=t.computed(()=>{const l={},{componentProperties:P}=e;return n&&(l["data-cq-data-path"]=P.cqPath,e.editConfig.resourceType&&(l["data-cq-resource-type"]=e.editConfig.resourceType)),l}),i=t.computed(()=>{var p;const l={},{componentProperties:P}=e,{appliedCssClassNames:h,cqType:f}=P,d=[];return h&&d.push(h),(p=e==null?void 0:e.containerProps)!=null&&p.class&&d.push(e.containerProps.class),f&&(f!=null&&f.endsWith("/container"))&&d.push("aem-editable"),d.length&&(l.class=d.join(" ")),l}),a=t.computed(()=>n&&typeof e.editConfig.isEmpty=="function"&&e.editConfig.isEmpty(e.componentProperties)?{class:"cq-placeholder","data-emptytext":e.editConfig.emptyLabel}:null);return(l,P)=>{var h,f,d,p;return!t.unref(n)&&e.componentProperties.hasOwnProperty("aemNoDecoration")&&e.componentProperties.aemNoDecoration||e.componentProperties.hasOwnProperty("cqHierarchyType")&&e.componentProperties.cqHierarchyType==="page"?(t.openBlock(),t.createBlock(t.resolveDynamicComponent((f=(h=t.unref(r)).default)==null?void 0:f.call(h)[0]),t.normalizeProps(t.mergeProps({key:0},{...t.unref(s),containerProps:e.containerProps})),null,16)):(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:1},{...c.value,...i.value})),[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((p=(d=t.unref(r)).default)==null?void 0:p.call(d)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(s),componentProperties:e.componentProperties})),null,16)),a.value?(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.mergeProps({key:0},a.value)),null,16)):t.createCommentVNode("",!0)],16))}}}),j=t.defineComponent({inheritAttrs:!1,__name:"CompositeEditableProvider",props:{editConfig:{type:Object,default:()=>({isEmpty:()=>!1})}},setup(o){const e=o,n=t.useSlots(),r=t.useAttrs();return(s,c)=>(t.openBlock(),t.createBlock(I,t.normalizeProps(t.guardReactiveProps({...t.unref(r),componentProperties:{...t.unref(r)},editConfig:e.editConfig})),{default:t.withCtx(()=>{var i,a;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((a=(i=t.unref(n)).default)==null?void 0:a.call(i)[0])))]}),_:1},16))}}),G=t.defineComponent({name:"ModelProvider",inheritAttrs:!1,props:{cqForceReload:{type:Boolean,default:!1},cqPath:{type:String,default:""},injectPropsOnInit:{type:Boolean,default:!1},itemPath:{type:String,default:""},pagePath:{type:String,default:""}},data(){return{updatedProps:{},updateDataListener:()=>{}}},computed:{updatedCqPath(){const{pagePath:o,itemPath:e,injectPropsOnInit:n,cqPath:r}=this.$props;return k.getCQPath({pagePath:o,itemPath:e,injectPropsOnInit:n,cqPath:r})}},mounted(){this.updateDataListener=this.updateData.bind(this);const o=this.updatedCqPath;this.injectPropsOnInit&&this.updateData(o),y.ModelManager.addListener(o,this.updateDataListener)},unmounted(){const o=this.updatedCqPath;y.ModelManager.removeListener(o,this.updateDataListener)},methods:{updateData(o){const e=t.inject("isInEditor",y.AuthoringUtils.isInEditor()),{pagePath:n,itemPath:r,injectPropsOnInit:s}=this.$props,c=o||this.$props.cqPath||n&&k.getCQPath({pagePath:n,itemPath:r,injectPropsOnInit:s});c&&y.ModelManager.getData({path:c,forceReload:this.cqForceReload}).then(i=>{i&&Object.keys(i).length>0&&(Object.assign(this.updatedProps,k.modelToProps(i)),s&&e&&y.PathUtils.dispatchGlobalCustomEvent("cq-async-content-loaded",{}))}).catch(i=>{console.error(i)})}}}),V=(o,e)=>{const n=o.__vccOpts||o;for(const[r,s]of e)n[r]=s;return n};function Q(o,e,n,r,s,c){var i,a;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((a=(i=o.$slots).default)==null?void 0:a.call(i)[0]),t.normalizeProps(t.guardReactiveProps({...o.$attrs,pagePath:o.pagePath,itemPath:o.itemPath,cqPath:o.updatedCqPath,...o.updatedProps})),null,16)}const A=V(G,[["render",Q]]),O=t.defineComponent({inheritAttrs:!1,__name:"CompositeModelProvider",props:{modelConfig:{type:Object,default:()=>({injectPropsOnInit:!1,forceReload:!1})}},setup(o){const e=o,n=t.useSlots(),r=t.useAttrs(),{modelConfig:s}=t.toRefs(e),c=r.cqForceReload||s.value.forceReload,{injectPropsOnInit:i}=s.value;return(a,l)=>(t.openBlock(),t.createBlock(A,t.mergeProps({"cq-force-reload":t.unref(c),"inject-props-on-init":t.unref(i)},{...t.unref(r)}),{default:t.withCtx(()=>{var P,h;return[(t.openBlock(),t.createBlock(t.resolveDynamicComponent((h=(P=t.unref(n)).default)==null?void 0:h.call(P)[0])))]}),_:1},16,["cq-force-reload","inject-props-on-init"]))}}),w=t.defineComponent({inheritAttrs:!1,__name:"ContextProvider",setup(o){const e=t.useSlots(),n=t.useAttrs(),r=t.inject("componentMapping",new u.ComponentMapping),s=t.inject("isInEditor",y.AuthoringUtils.isInEditor());return t.provide("isInEditor",s),t.provide("componentMapping",r),(c,i)=>{var a,l;return t.openBlock(),t.createBlock(t.resolveDynamicComponent((l=(a=t.unref(e)).default)==null?void 0:l.call(a)[0]),t.normalizeProps(t.guardReactiveProps({...t.unref(n)})),null,16)}}}),N=o=>t.h(w,{},()=>[t.h(o)]),$=(o,e)=>t.h(O,{modelConfig:e},()=>[t.h(o)]),D=(o,e)=>t.h(j,{editConfig:e},()=>[t.h(o)]),W=(o,e,n)=>{const{injectPropsOnInit:r=!0,forceReload:s=!1,...c}=n||{},i={injectPropsOnInit:r,forceReload:s,...c};let a=o;return a=N($(D(a,e),i)),a},x=u.ComponentMapping.map,H=u.ComponentMapping.get;u.ComponentMapping.map=function(e,n,r={isEmpty:()=>!1},s={}){const{injectPropsOnInit:c=!1,...i}=s||{},a=W(n,r,{injectPropsOnInit:c,...i});return x.call(u.ComponentMapping,e,a),a},u.ComponentMapping.get=H;const J=o=>(e,n,r={})=>u.ComponentMapping.map(o,e,n,r),X=(o,e,n,r,s,c)=>{let i=[];o&&(i=[o]),e&&i.push(e),n&&i.push(...n.split(" "));const a=r==null?void 0:r.class;return c&&a&&!s&&i.push(a),i},Y=o=>({aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},baseCssClass:{type:String,default:o},containerProps:{type:Object,default:()=>{}},cssClassNames:{type:String},id:{type:String}}),Z=["data-cq-data-path","data-emptytext"],L=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholder",props:{emptyLabel:{type:String},path:{type:String}},setup(o){const e=o;return(n,r)=>(t.openBlock(),t.createElementBlock("div",{"data-cq-data-path":e.path,"data-emptytext":e.emptyLabel,class:"aem-AllowedComponent--component cq-placeholder placeholder"},null,8,Z))}}),K=["data-text"],S=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentPlaceholderList",props:{emptyLabel:{type:String},components:{type:Array},placeholderProps:{type:Object},title:{type:String},cqPath:{type:String}},setup(o){const e=o,n=t.computed(()=>e.components&&e.components.length>0?e.title:e.emptyLabel);return(r,s)=>{var c;return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["aem-AllowedComponent--list",(c=e.placeholderProps)==null?void 0:c.placeholderClassNames])},[t.createElementVNode("div",{"data-text":n.value,class:"aem-AllowedComponent--title"},null,8,K),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.components,i=>(t.openBlock(),t.createBlock(L,{key:i.path,"empty-label":i.title,path:i.path},null,8,["empty-label","path"]))),128))],2)}}}),v=["data-cq-data-path"],T=t.defineComponent({__name:"ContainerPlaceholder",props:{cqPath:{type:String,default:""},placeholderClassNames:{type:String}},setup(o){const e=o;return(n,r)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(e.placeholderClassNames),"data-cq-data-path":`${e.cqPath}/*`},null,10,v))}}),R=t.defineComponent({name:"Container",inheritAttrs:!1,__name:"Container",props:{aemNoDecoration:{type:Boolean,default:!1},appliedCssClassNames:{type:String},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0}},setup(o){const e=o,n=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",y.AuthoringUtils.isInEditor()),r=t.inject("componentMapping",new u.ComponentMapping),s=t.computed(()=>{let a={};return typeof e.getContainerProps=="function"?a=e.getContainerProps():(a={class:"aem-container"},n&&(a["data-cq-data-path"]=e.cqPath)),a}),c=t.computed(()=>k.getChildComponents(e.cqPath,e.cqItems,e.cqItemsOrder,e.aemNoDecoration,typeof e.getItemComponentProps=="function"?e.getItemComponentProps:()=>({}),!1,r)),i=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"});return(a,l)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps({...s.value})),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(c.value,P=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(P),{key:P.toString()}))),128)),t.unref(n)?(t.openBlock(),t.createBlock(T,t.normalizeProps(t.mergeProps({key:0},i.value)),null,16)):t.createCommentVNode("",!0)],16))}}),z=t.defineComponent({inheritAttrs:!1,__name:"AllowedComponentsContainer",props:{_allowedComponentPlaceholderListEmptyLabel:{type:String,default:"No allowed components"},aemNoDecoration:{type:Boolean,default:!1},allowedComponents:{type:Object},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""},getContainerProps:{type:Function},getItemComponentProps:{type:Function},getPlaceholderProps:{type:Function},isInEditor:{type:Boolean,default:void 0},title:{type:String}},setup(o){const e=o,n=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",y.AuthoringUtils.isInEditor()),r=t.computed(()=>typeof e.getPlaceholderProps=="function"?e.getPlaceholderProps():{cqPath:e.cqPath,placeholderClassNames:"new section"}),s=t.useAttrs();return(c,i)=>{var a;return t.unref(n)&&e.allowedComponents&&((a=e.allowedComponents)!=null&&a.applicable)?(t.openBlock(),t.createBlock(S,{key:0,components:e.allowedComponents.components,"cq-path":e.cqPath,"empty-label":e._allowedComponentPlaceholderListEmptyLabel,"placeholder-props":r.value,title:e.title},null,8,["components","cq-path","empty-label","placeholder-props","title"])):(t.openBlock(),t.createBlock(R,t.mergeProps({key:1,"aem-no-decoration":e.aemNoDecoration,"cq-items":e.cqItems,"cq-items-order":e.cqItemsOrder,"cq-path":e.cqPath,"get-container-props":e.getContainerProps,"get-item-component-props":e.getItemComponentProps,"get-placeholder-props":e.getPlaceholderProps,"is-in-editor":t.unref(n)},{...t.unref(s)}),null,16,["aem-no-decoration","cq-items","cq-items-order","cq-path","get-container-props","get-item-component-props","get-placeholder-props","is-in-editor"]))}}}),tt=t.defineComponent({name:"Page",inheritAttrs:!1,__name:"Page",props:{aemNoDecoration:{type:Boolean,default:!1},cqChildren:{type:Object,default:()=>({})},cqItems:{type:Object,default:()=>({})},cqItemsOrder:{type:Array,default:()=>[]},cqPath:{type:String,default:""}},setup(o){const e=t.useAttrs(),n=t.inject("isInEditor",y.AuthoringUtils.isInEditor()),r=t.inject("componentMapping",new u.ComponentMapping),s=o,c=t.computed(()=>k.getChildComponents(s.cqPath,s.cqItems,s.cqItemsOrder,s.aemNoDecoration,()=>({}),!0,r)),i=t.computed(()=>k.getChildPages(s.cqChildren,r)),a=t.computed(()=>{const l=["aem-page"];e.cssClassNames&&l.push(...e.cssClassNames.split(" "));const P={class:l.join(" ")};return n&&(P["data-cq-data-path"]=s.cqPath),P});return t.onMounted(()=>{e.title&&(document.title=e.title)}),t.onUpdated(()=>{e.title&&(document.title=e.title)}),(l,P)=>(t.openBlock(),t.createElementBlock("div",t.normalizeProps(t.guardReactiveProps(a.value)),[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(c.value,h=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(h),{key:h.toString()}))),128)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.value,h=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(h),{key:h.toString()}))),128))],16))}}),et=t.defineComponent({inheritAttrs:!1,__name:"ResponsiveGrid",props:{aemNoDecoration:{type:Boolean,default:!1},cqPath:{type:String,default:""},gridClassNames:{type:String},columnClassNames:{type:Object},isInEditor:{type:Boolean,default:void 0},title:{type:String,default:"Layout Container"}},setup(o){const e=o,n=t.useAttrs(),r=typeof e.isInEditor<"u"?e.isInEditor:t.inject("isInEditor",y.AuthoringUtils.isInEditor()),s=()=>{const a={},l=["aem-container"];return e.gridClassNames&&l.push(e.gridClassNames),a.class=l.join(" "),r&&(a["data-cq-data-path"]=e.cqPath),a},c=()=>{const a={cqPath:e.cqPath},l=["new","section","aem-Grid-newComponent"];return a.placeholderClassNames=l.join(" "),a},i=a=>{const l={};return e.columnClassNames&&e.columnClassNames[a]&&(l.class=e.columnClassNames[a]),l};return(a,l)=>(t.openBlock(),t.createBlock(z,t.mergeProps({"aem-no-decoration":e.aemNoDecoration,"cq-path":e.cqPath,"get-container-props":s,"get-item-component-props":i,"get-placeholder-props":c,"is-in-editor":t.unref(r),title:e.title},{...t.unref(n)}),null,16,["aem-no-decoration","cq-path","is-in-editor","title"]))}});Object.defineProperty(m,"ComponentMapping",{enumerable:!0,get:()=>u.ComponentMapping}),m.AllowedComponentPlaceholder=L,m.AllowedComponentPlaceholderList=S,m.AllowedComponentsContainer=z,m.CompositeEditableProvider=j,m.CompositeModelProvider=O,m.Container=R,m.ContainerPlaceholder=T,m.ContextProvider=w,m.EditableProvider=I,m.MapTo=J,m.ModelProvider=A,m.Page=tt,m.ResponsiveGrid=et,m.Utils=k,m.componentClassNames=X,m.componentProperties=Y,m.withContext=N,m.withEditable=D,m.withModel=$,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
